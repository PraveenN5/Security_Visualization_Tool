<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Key Strength Analyzer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: linear-gradient(135deg, #1e1b4b 0%, #312e81 100%);
            color: #f0f0f0;
            font-family: 'Inter', sans-serif;
            min-height: 100vh;
            overflow-y: auto !important;
            overflow-x: hidden;
        }

        .nav-bar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background-color: rgba(31, 37, 46, 0.95);
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(1, 233, 248, 0.1);
        }

        .nav-links {
            display: flex;
            align-items: center;
        }

        .nav-links a {
            color: #fff;
            text-decoration: none;
            margin-right: 1.5rem;
            transition: color 0.3s ease;
        }

        .nav-links a:hover {
            color: #01E9F8;
        }

        .logo {
            color: #01E9F8;
            font-weight: 700;
            font-size: 1.5rem;
            text-decoration: none;
        }

        .nav-right {
            display: flex;
            align-items: center;
        }

        .welcome-text {
            color: #01E9F8;
            font-size: 1.1rem;
            margin-right: 1rem;
        }

        .sign-in-btn {
            background-color: #01E9F8;
            color: #000;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .sign-in-btn:hover {
            background-color: #00b3d8;
            transform: translateY(-2px);
        }

        .animate-fade {
            animation: fadeIn 0.5s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            color: #1f2937;
        }
        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
        }
        .info-box {
            background: linear-gradient(135deg, #ddd6fe 0%, #c4b5fd 100%);
        }
        
        input, select {
            background: white !important;
            color: #1f2937 !important;
            border: 1px solid #d1d5db !important;
        }
        input::placeholder {
            color: #9ca3af !important;
        }
        
        .title-gradient {
            background: linear-gradient(135deg, #8b5cf6 0%, #6d28d9 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .strength-meter {
            height: 10px;
            width: 100%;
            background-color: #ddd;
            border-radius: 5px;
            margin-top: 5px;
            overflow: hidden;
        }

        .strength-fill {
            height: 100%;
            width: 0%;
            transition: width 0.5s ease-in-out;
        }

        .weak {
            background-color: #ef4444;
        }

        .moderate {
            background-color: #f59e0b;
        }

        .strong {
            background-color: #10b981;
        }

        .very-strong {
            background-color: #047857;
        }

        /* Attack visualization styles */
        #attack-visualization {
            margin-top: 20px;
            background-color: #f3f4f6;
            border-radius: 10px;
            padding: 15px;
            overflow: hidden;
            position: relative;
            height: 200px;
            border: 1px solid #e5e7eb;
        }
        
        .attack-visual-container {
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
            height: 100%;
            overflow-y: auto;
            padding: 10px;
            justify-content: center;
        }
        
        .key-character {
            background-color: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 3px;
            color: #1f2937;
            font-family: monospace;
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 30px;
            height: 30px;
            position: relative;
            transition: all 0.3s ease;
            margin: 2px;
        }
        
        .key-character.testing {
            background-color: #fef3c7;
            border-color: #f59e0b;
            animation: pulse 0.8s infinite alternate;
        }
        
        .key-character.cracked {
            background-color: #d1fae5;
            border-color: #10b981;
        }
        
        .key-character.failed {
            background-color: #fee2e2;
            border-color: #ef4444;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            100% { transform: scale(1.1); }
        }
    </style>
</head>
<body>
    <div class="nav-bar">
        <div class="nav-links">
            <a href="index.html">Home</a>
            <a href="key-strength.html">Key Strength Analyzer</a>
            <a href="algorithm-comparison.html">Algorithm Comparison</a>
        </div>
        <div id="userInfo">
            <div class="welcome-text" id="welcome-text" style="display: none;">Welcome, <span id="username"></span>!</div>
            <button class="sign-in-btn" id="sign-in-btn" onclick="window.location.href='login.html'" title="Sign In">Sign In</button>
        </div>
    </div>

    <div class="container mx-auto px-4 py-8 max-w-full" style="padding-top: 80px;">
        <h1 class="text-3xl font-bold text-center mb-8 title-gradient">Cryptographic Key Strength Analyzer</h1>

        <!-- Input Section -->
        <div class="card rounded-lg mb-8 p-6">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <h2 class="text-xl font-semibold mb-4">Enter Key or Password</h2>
                    <div class="flex">
                        <input 
                            type="text" 
                            id="key-input" 
                            placeholder="Enter your key or password"
                            class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500"
                        >
                        <button 
                            id="generate-key-btn"
                            class="bg-purple-500 text-white px-4 py-2 rounded-md hover:bg-purple-600 transition-colors ml-2"
                            title="Generate Random Key"
                        >
                            <i class="fas fa-random"></i>
                        </button>
                    </div>
                    <p class="text-sm text-gray-500 mt-2">Enter your actual key or a key with similar characteristics for accurate results.</p>
                </div>
                <div>
                    <h2 class="text-xl font-semibold mb-4">Key Settings</h2>
                    <div class="grid grid-cols-2 gap-4">
                        <div class="flex items-center">
                            <input type="checkbox" id="include-uppercase" checked class="mr-2">
                            <label for="include-uppercase">Include A-Z</label>
                        </div>
                        <div class="flex items-center">
                            <input type="checkbox" id="include-lowercase" checked class="mr-2">
                            <label for="include-lowercase">Include a-z</label>
                        </div>
                        <div class="flex items-center">
                            <input type="checkbox" id="include-numbers" checked class="mr-2">
                            <label for="include-numbers">Include 0-9</label>
                        </div>
                        <div class="flex items-center">
                            <input type="checkbox" id="include-special" checked class="mr-2">
                            <label for="include-special">Include !@#$%</label>
                        </div>
                    </div>
                    <div class="flex items-center mt-4">
                        <label for="key-length" class="mr-2">Length:</label>
                        <input type="number" id="key-length" value="16" min="8" max="64" class="w-20 px-2 py-1 border rounded-md">
                    </div>
                </div>
            </div>

            <div class="mt-6">
                <h2 class="text-xl font-semibold mb-4">Analysis Settings</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label for="algorithm-select" class="block mb-2">Algorithm:</label>
                        <select 
                            id="algorithm-select"
                            class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500"
                        >
                            <option value="aes">AES</option>
                            <option value="des">DES</option>
                            <option value="rsa">RSA</option>
                        </select>
                    </div>
                    <div>
                        <p class="mb-2">Attack Type to Simulate:</p>
                        <div class="grid grid-cols-2 gap-3">
                            <div class="flex items-center bg-gray-100 p-2 rounded">
                                <input type="radio" id="brute-force" name="attack-type" value="brute-force" checked class="mr-2">
                                <label for="brute-force">Brute Force</label>
                            </div>
                            <div class="flex items-center bg-gray-100 p-2 rounded">
                                <input type="radio" id="dictionary" name="attack-type" value="dictionary" class="mr-2">
                                <label for="dictionary">Dictionary Attack</label>
                            </div>
                            <div class="flex items-center bg-gray-100 p-2 rounded">
                                <input type="radio" id="rainbow" name="attack-type" value="rainbow" class="mr-2">
                                <label for="rainbow">Rainbow Table</label>
                            </div>
                            <div class="flex items-center bg-gray-100 p-2 rounded">
                                <input type="radio" id="pattern" name="attack-type" value="pattern" class="mr-2">
                                <label for="pattern">Pattern Analysis</label>
                            </div>
                        </div>
                        <div class="flex items-center mt-3">
                            <input type="checkbox" id="simulate-attack" checked class="mr-2">
                            <label for="simulate-attack">Run attack simulation</label>
                        </div>
                    </div>
                </div>
            </div>

            <div class="mt-6 flex justify-center">
                <button 
                    id="analyze-btn"
                    class="bg-purple-500 text-white px-6 py-2 rounded-md hover:bg-purple-600 transition-colors"
                >
                    Analyze Key Strength
                </button>
            </div>
        </div>

        <!-- Results Section (Hidden initially) -->
        <div class="results" style="display: none;">
            <div class="grid md:grid-cols-2 gap-8">
                <!-- Key Strength Analysis -->
                <div class="card rounded-lg p-6">
                    <h3 class="text-lg font-semibold mb-4">Key Strength Analysis</h3>
                    <div class="info-box p-4 rounded-md mb-4">
                        <div class="mb-4">
                            <p class="font-medium">Entropy:</p>
                            <p class="text-xl font-mono" id="entropy-value">0 bits</p>
                            <div class="strength-meter mt-2">
                                <div id="entropy-fill" class="strength-fill"></div>
                            </div>
                            <p class="text-sm text-gray-600">Entropy measures the randomness in your key. Higher is better.</p>
                        </div>
                        <div class="mb-4">
                            <p class="font-medium">Strength Rating:</p>
                            <p class="text-xl" id="strength-rating">Unknown</p>
                            <div class="strength-meter">
                                <div class="strength-fill"></div>
                            </div>
                        </div>
                        <div>
                            <p class="font-medium">Estimated Time to Break:</p>
                            <p class="text-xl font-mono" id="time-to-break">Unknown</p>
                        </div>
                    </div>
                </div>

                <!-- Attack Simulation -->
                <div id="attack-simulation" class="card rounded-lg p-6" style="display: none;">
                    <h3 class="text-lg font-semibold mb-4">Attack Simulation</h3>
                    <div class="mb-4">
                        <p class="font-medium mb-2">Attack Progress:</p>
                        <div class="strength-meter">
                            <div id="attack-progress" class="strength-fill"></div>
                        </div>
                        <p class="text-sm mt-2" id="attack-status">Preparing simulation...</p>
                    </div>
                    
                    <div class="bg-gray-50 p-4 rounded-md">
                        <p class="font-medium mb-2">Visualization:</p>
                        <div id="attack-visualization" class="canvas-container" style="min-height: 200px; background-color: #f8fafc;">
                            <div class="attack-visual-container" id="attack-visual-container"></div>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-2 mt-4 text-xs text-gray-600">
                        <div class="flex items-center">
                            <div class="w-3 h-3 bg-gray-100 border border-gray-300 mr-1"></div>
                            <span>Not tested</span>
                        </div>
                        <div class="flex items-center">
                            <div class="w-3 h-3 bg-yellow-100 border border-yellow-400 mr-1"></div>
                            <span>Currently testing</span>
                        </div>
                        <div class="flex items-center">
                            <div class="w-3 h-3 bg-green-100 border border-green-400 mr-1"></div>
                            <span>Character cracked</span>
                        </div>
                        <div class="flex items-center">
                            <div class="w-3 h-3 bg-red-100 border border-red-400 mr-1"></div>
                            <span>Failed attempt</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Recommendations Section -->
            <div class="card rounded-lg p-6 mt-8">
                <h3 class="text-lg font-semibold mb-4">Recommendations</h3>
                <ul id="recommendations-list" class="list-disc pl-5 space-y-2"></ul>
            </div>
        </div>
    </div>

    <script>
        // Check login status when page loads
        document.addEventListener('DOMContentLoaded', async function() {
            // Setup event listeners
            document.getElementById('generate-key-btn').addEventListener('click', generateRandomKey);
            document.getElementById('analyze-btn').addEventListener('click', analyzeKeyStrength);
            
            // Initialize option groups
            document.querySelectorAll('input[type="radio"], input[type="checkbox"]').forEach(input => {
                input.addEventListener('change', function() {
                    if (this.type === 'radio' && this.checked) {
                        document.querySelectorAll(`input[name="${this.name}"]`).forEach(radio => {
                            const group = radio.closest('.bg-gray-100');
                            if (group) {
                                if (radio.checked) {
                                    group.style.backgroundColor = '#ddd6fe';
                                    group.style.borderColor = '#a78bfa';
                                } else {
                                    group.style.backgroundColor = '#f3f4f6';
                                    group.style.borderColor = '#e5e7eb';
                                }
                            }
                        });
                    }
                });
            });

            // Check login status
            let sessionId = getCookie('session_id');
            
            if (!sessionId) {
                // Reset the userInfo to show the sign-in button
                const userInfo = document.getElementById('userInfo');
                userInfo.innerHTML = `
                    <button class="sign-in-btn" onclick="window.location.href='login.html'" title="Sign In">Sign In</button>
                `;
                return;
            }
            
            try {
                const response = await fetch('https://security-viz-api.onrender.com/check-session', {
                    method: 'GET',
                    headers: {
                        'X-Session-ID': sessionId,
                        'Accept': 'application/json'
                    },
                    credentials: 'include'
                });
                
                const data = await response.json();
                
                if (response.ok && data.authenticated) {
                    // Replace the userInfo content with welcome message and logout button
                    const userInfo = document.getElementById('userInfo');
                    userInfo.innerHTML = `
                        <span class="welcome-text">Welcome, ${data.username}</span>
                        <button class="sign-in-btn" onclick="logout()" title="Sign out">Logout</button>
                    `;
                } else {
                    // If session is invalid, remove the cookie
                    document.cookie = 'session_id=; path=/; expires=Thu, 01 Jan 1970 00:00:01 GMT;';
                    // Reset the userInfo to show the sign-in button
                    const userInfo = document.getElementById('userInfo');
                    userInfo.innerHTML = `
                        <button class="sign-in-btn" onclick="window.location.href='login.html'" title="Sign In">Sign In</button>
                    `;
                }
            } catch (error) {
                console.error('Error checking session:', error);
                // Reset the userInfo to show the sign-in button on error
                const userInfo = document.getElementById('userInfo');
                userInfo.innerHTML = `
                    <button class="sign-in-btn" onclick="window.location.href='login.html'" title="Sign In">Sign In</button>
                `;
            }
        });

        // Function to get cookie value by name
        function getCookie(name) {
            const value = `; ${document.cookie}`;
            const parts = value.split(`; ${name}=`);
            if (parts.length === 2) return parts.pop().split(';').shift();
            return null;
        }

        // Logout function
        async function logout() {
            const sessionId = getCookie('session_id');
            if (!sessionId) {
                window.location.href = 'login.html';
                return;
            }

            try {
                const response = await fetch('https://security-viz-api.onrender.com/logout', {
                    method: 'POST',
                    headers: {
                        'X-Session-ID': sessionId,
                        'Content-Type': 'application/json'
                    },
                    credentials: 'include'
                });

                // Remove the session cookie regardless of server response
                document.cookie = 'session_id=; path=/; expires=Thu, 01 Jan 1970 00:00:01 GMT;';
                window.location.reload();
            } catch (error) {
                console.error('Logout failed:', error);
                // Still remove cookie and reload on error
                document.cookie = 'session_id=; path=/; expires=Thu, 01 Jan 1970 00:00:01 GMT;';
                window.location.reload();
            }
        }

        // Generate a random key
        function generateRandomKey() {
            const length = document.getElementById('key-length').value;
            const includeUppercase = document.getElementById('include-uppercase').checked;
            const includeLowercase = document.getElementById('include-lowercase').checked;
            const includeNumbers = document.getElementById('include-numbers').checked;
            const includeSpecial = document.getElementById('include-special').checked;
            
            let chars = '';
            if (includeUppercase) chars += 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
            if (includeLowercase) chars += 'abcdefghijklmnopqrstuvwxyz';
            if (includeNumbers) chars += '0123456789';
            if (includeSpecial) chars += '!@#$%^&*()_+-=[]{}|;:,.<>?';
            
            if (chars === '') {
                alert('Please select at least one character type');
                return;
            }
            
            let key = '';
            for (let i = 0; i < length; i++) {
                key += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            
            document.getElementById('key-input').value = key;
        }

        // Calculate entropy of a key
        function calculateEntropy(key) {
            if (!key) return 0;
            
            const charSetSize = getCharSetSize(key);
            return Math.log2(Math.pow(charSetSize, key.length));
        }
        
        // Get character set size based on actual characters used in key
        function getCharSetSize(key) {
            const hasUppercase = /[A-Z]/.test(key);
            const hasLowercase = /[a-z]/.test(key);
            const hasNumbers = /[0-9]/.test(key);
            const hasSpecial = /[^A-Za-z0-9]/.test(key);
            
            let charSetSize = 0;
            if (hasUppercase) charSetSize += 26;
            if (hasLowercase) charSetSize += 26;
            if (hasNumbers) charSetSize += 10;
            if (hasSpecial) charSetSize += 33; // Approximate for special characters
            
            return charSetSize === 0 ? 1 : charSetSize; // Avoid division by zero
        }
        
        // Get human-readable time from seconds
        function formatTime(seconds) {
            if (seconds < 60) return `${seconds.toFixed(2)} seconds`;
            if (seconds < 3600) return `${(seconds / 60).toFixed(2)} minutes`;
            if (seconds < 86400) return `${(seconds / 3600).toFixed(2)} hours`;
            if (seconds < 31536000) return `${(seconds / 86400).toFixed(2)} days`;
            if (seconds < 315360000) return `${(seconds / 31536000).toFixed(2)} years`;
            
            // For extremely large numbers, use scientific notation with "years"
            const years = seconds / 31536000;
            if (years < 1e15) return `${years.toLocaleString()} years`;
            
            return `${years.toExponential(2)} years`;
        }
        
        // Analyze key strength
        function analyzeKeyStrength() {
            const key = document.getElementById('key-input').value;
            
            if (!key) {
                alert('Please enter a key or generate one');
                return;
            }
            
            // Calculate entropy
            const entropy = calculateEntropy(key);
            document.getElementById('entropy-value').textContent = `${entropy.toFixed(2)} bits`;
            
            // Update entropy bar
            const entropyFill = document.getElementById('entropy-fill');
            const entropyPercent = Math.min(entropy / 128 * 100, 100); // Scale to max of 128 bits
            entropyFill.style.width = `${entropyPercent}%`;
            
            if (entropy < 40) {
                entropyFill.className = 'strength-fill weak';
            } else if (entropy < 80) {
                entropyFill.className = 'strength-fill moderate';
            } else if (entropy < 100) {
                entropyFill.className = 'strength-fill strong';
            } else {
                entropyFill.className = 'strength-fill very-strong';
            }
            
            // Determine strength rating
            let strengthRating;
            let strengthFillClass;
            let strengthFillPercent;
            
            if (entropy < 40) {
                strengthRating = 'Very Weak';
                strengthFillClass = 'weak';
                strengthFillPercent = 20;
            } else if (entropy < 60) {
                strengthRating = 'Weak';
                strengthFillClass = 'weak';
                strengthFillPercent = 40;
            } else if (entropy < 80) {
                strengthRating = 'Moderate';
                strengthFillClass = 'moderate';
                strengthFillPercent = 60;
            } else if (entropy < 100) {
                strengthRating = 'Strong';
                strengthFillClass = 'strong';
                strengthFillPercent = 80;
            } else {
                strengthRating = 'Very Strong';
                strengthFillClass = 'very-strong';
                strengthFillPercent = 100;
            }
            
            document.getElementById('strength-rating').textContent = strengthRating;
            const strengthFill = document.querySelector('.strength-fill');
            strengthFill.className = `strength-fill ${strengthFillClass}`;
            strengthFill.style.width = `${strengthFillPercent}%`;
            
            // Calculate estimated time to break
            const attackType = document.querySelector('input[name="attack-type"]:checked').value;
            const algorithm = document.getElementById('algorithm-select').value;
            
            const timeToBreak = estimateBreakTime(key, entropy, attackType, algorithm);
            document.getElementById('time-to-break').textContent = timeToBreak;
            
            // Show recommendations
            showRecommendations(key, entropy, attackType, algorithm);
            
            // Show the results
            document.querySelector('.results').style.display = 'block';
            
            // Simulate attack if checkbox is checked
            if (document.getElementById('simulate-attack').checked) {
                document.getElementById('attack-simulation').style.display = 'block';
                simulateAttack(key, attackType);
            } else {
                document.getElementById('attack-simulation').style.display = 'none';
            }
        }
        
        // Estimate time to break the key
        function estimateBreakTime(key, entropy, attackType, algorithm) {
            // Approximate attempts per second based on attack type and algorithm
            let attemptsPerSecond;
            
            switch (algorithm) {
                case 'aes':
                    attemptsPerSecond = attackType === 'brute-force' ? 1e9 : 1e12;
                    break;
                case 'des':
                    attemptsPerSecond = attackType === 'brute-force' ? 1e10 : 1e13;
                    break;
                case 'rsa':
                    attemptsPerSecond = attackType === 'brute-force' ? 1e6 : 1e9;
                    break;
                default:
                    attemptsPerSecond = 1e9;
            }
            
            // Adjust for attack type
            switch (attackType) {
                case 'dictionary':
                    attemptsPerSecond *= 100; // Dictionary attacks can be much faster
                    break;
                case 'rainbow':
                    attemptsPerSecond *= 10000; // Rainbow tables are even faster
                    break;
                case 'pattern':
                    attemptsPerSecond *= 1000; // Pattern analysis is faster than brute force
                    break;
            }
            
            // Calculate total possible combinations
            const possibleCombinations = Math.pow(2, entropy);
            
            // On average, need to try half of all combinations
            const averageAttempts = possibleCombinations / 2;
            
            // Calculate time in seconds
            const timeInSeconds = averageAttempts / attemptsPerSecond;
            
            return formatTime(timeInSeconds);
        }
        
        // Show recommendations based on analysis
        function showRecommendations(key, entropy, attackType, algorithm) {
            const recommendationsList = document.getElementById('recommendations-list');
            recommendationsList.innerHTML = '';
            
            const addRecommendation = (recommendation) => {
                const li = document.createElement('li');
                li.textContent = recommendation;
                recommendationsList.appendChild(li);
            };
            
            // Basic recommendations
            if (entropy < 60) {
                addRecommendation('Increase your key length to improve security.');
            }
            
            if (!/[A-Z]/.test(key)) {
                addRecommendation('Add uppercase letters to increase entropy.');
            }
            
            if (!/[a-z]/.test(key)) {
                addRecommendation('Add lowercase letters to increase entropy.');
            }
            
            if (!/[0-9]/.test(key)) {
                addRecommendation('Add numbers to increase entropy.');
            }
            
            if (!/[^A-Za-z0-9]/.test(key)) {
                addRecommendation('Add special characters to increase entropy.');
            }
            
            // Check for common patterns
            if (/(.)\1\1/.test(key)) {
                addRecommendation('Avoid using repeated characters (e.g., "aaa").');
            }
            
            if (/^(?:abcdef|qwerty|asdfgh|zxcvbn)/i.test(key)) {
                addRecommendation('Avoid using keyboard sequences (e.g., "qwerty").');
            }
            
            if (/(?:password|admin|123456|qwerty)/i.test(key)) {
                addRecommendation('Avoid using common passwords or password fragments.');
            }
            
            // Algorithm-specific recommendations
            switch (algorithm) {
                case 'aes':
                    if (key.length < 16) {
                        addRecommendation('For AES, consider using at least a 128-bit key (16 characters).');
                    }
                    break;
                case 'des':
                    if (key.length < 8) {
                        addRecommendation('For DES, consider using at least an 8-character key.');
                    }
                    addRecommendation('Note: DES is considered weak by modern standards. Consider using AES instead.');
                    break;
                case 'rsa':
                    if (entropy < 128) {
                        addRecommendation('For RSA, keys should have at least 2048 bits of entropy.');
                    }
                    break;
            }
            
            // Attack-specific recommendations
            switch (attackType) {
                case 'dictionary':
                    addRecommendation('Use random strings rather than dictionary words to resist dictionary attacks.');
                    break;
                case 'rainbow':
                    addRecommendation('Use a salt with your password or key to mitigate rainbow table attacks.');
                    break;
                case 'pattern':
                    addRecommendation('Avoid patterns like dates, phone numbers, or sequential characters.');
                    break;
            }
            
            // If no recommendations were added, add a positive message
            if (recommendationsList.childElementCount === 0) {
                if (entropy >= 100) {
                    addRecommendation('Excellent key! Your key has very strong security properties.');
                } else {
                    addRecommendation('Your key meets basic security requirements, but you can always make it stronger.');
                }
            }
        }
        
        // Simulate an attack on the key
        function simulateAttack(key, attackType) {
            const attackVisualContainer = document.getElementById('attack-visual-container');
            attackVisualContainer.innerHTML = '';
            
            const attackProgress = document.getElementById('attack-progress');
            attackProgress.style.width = '0%';
            attackProgress.className = 'strength-fill moderate';
            
            const attackStatus = document.getElementById('attack-status');
            attackStatus.textContent = 'Starting attack simulation...';
            
            // Create a visual representation of the key
            for (let i = 0; i < key.length; i++) {
                const charDiv = document.createElement('div');
                charDiv.className = 'key-character';
                charDiv.textContent = '*';
                charDiv.dataset.index = i;
                attackVisualContainer.appendChild(charDiv);
            }
            
            // Start the attack simulation
            let crackedChars = 0;
            const totalChars = key.length;
            let currentChar = 0;
            
            // Determine simulation speed based on attack type
            let simSpeed = 500; // milliseconds per character
            if (attackType === 'rainbow') simSpeed = 200;
            if (attackType === 'dictionary') simSpeed = 300;
            
            // Function to update progress
            const updateProgress = () => {
                const progressPercent = (crackedChars / totalChars) * 100;
                attackProgress.style.width = `${progressPercent}%`;
                attackStatus.textContent = `Cracked ${crackedChars} of ${totalChars} characters`;
            };
            
            // Simulated attack loop
            const attackInterval = setInterval(() => {
                // All characters cracked, end simulation
                if (currentChar >= totalChars) {
                    clearInterval(attackInterval);
                    attackStatus.textContent = `Attack completed. Cracked ${crackedChars} of ${totalChars} characters.`;
                    return;
                }
                
                const charDiv = attackVisualContainer.querySelector(`[data-index="${currentChar}"]`);
                charDiv.className = 'key-character testing';
                
                // Simulate cracking attempt with some randomness
                setTimeout(() => {
                    const successRate = attackType === 'brute-force' ? 0.7 : 
                                        attackType === 'dictionary' ? 0.8 :
                                        attackType === 'rainbow' ? 0.9 : 0.75;
                                        
                    const isSuccessful = Math.random() < successRate;
                    
                    if (isSuccessful) {
                        charDiv.className = 'key-character cracked';
                        charDiv.textContent = key[currentChar];
                        crackedChars++;
                    } else {
                        charDiv.className = 'key-character failed';
                    }
                    
                    updateProgress();
                    currentChar++;
                }, simSpeed / 2);
            }, simSpeed);
        }
    </script>
</body>
</html> 